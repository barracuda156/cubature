<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Adaptive multivariate integration over hypercubes (hcubature and pcubature) — hcubature • cubature</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Adaptive multivariate integration over hypercubes (hcubature and pcubature) — hcubature" />

<meta property="og:description" content="The function performs adaptive multidimensional integration (cubature) of
(possibly) vector-valued integrands over hypercubes. The function includes
a vector interface where the integrand may be evaluated at several hundred
points in a single call." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">cubature</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/cubature.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Adaptive multivariate integration over hypercubes (hcubature and pcubature)</h1>
    
    <div class="hidden name"><code>hcubature.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>The function performs adaptive multidimensional integration (cubature) of
(possibly) vector-valued integrands over hypercubes. The function includes
a vector interface where the integrand may be evaluated at several hundred
points in a single call.</p>
    
    </div>

    <pre class="usage"><span class='fu'>hcubature</span>(<span class='no'>f</span>, <span class='no'>lowerLimit</span>, <span class='no'>upperLimit</span>, <span class='no'>...</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>1e-05</span>, <span class='kw'>fDim</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>maxEval</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>absError</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>doChecking</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>vectorInterface</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>norm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"INDIVIDUAL"</span>, <span class='st'>"PAIRED"</span>, <span class='st'>"L2"</span>, <span class='st'>"L1"</span>,
  <span class='st'>"LINF"</span>))

<span class='fu'>pcubature</span>(<span class='no'>f</span>, <span class='no'>lowerLimit</span>, <span class='no'>upperLimit</span>, <span class='no'>...</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fl'>1e-05</span>, <span class='kw'>fDim</span> <span class='kw'>=</span> <span class='fl'>1</span>,
  <span class='kw'>maxEval</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>absError</span> <span class='kw'>=</span> <span class='fl'>0</span>, <span class='kw'>doChecking</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>vectorInterface</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>norm</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"INDIVIDUAL"</span>, <span class='st'>"PAIRED"</span>, <span class='st'>"L2"</span>, <span class='st'>"L1"</span>,
  <span class='st'>"LINF"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>f</th>
      <td><p>The function (integrand) to be integrated</p></td>
    </tr>
    <tr>
      <th>lowerLimit</th>
      <td><p>The lower limit of integration, a vector for
hypercubes</p></td>
    </tr>
    <tr>
      <th>upperLimit</th>
      <td><p>The upper limit of integration, a vector for
hypercubes</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>All other arguments passed to the function f</p></td>
    </tr>
    <tr>
      <th>tol</th>
      <td><p>The maximum tolerance, default 1e-5.</p></td>
    </tr>
    <tr>
      <th>fDim</th>
      <td><p>The dimension of the integrand, default 1, bears no
relation to the dimension of the hypercube</p></td>
    </tr>
    <tr>
      <th>maxEval</th>
      <td><p>The maximum number of function evaluations needed,
default 0 implying no limit. Note that the actual number of
function evaluations performed is only approximately guaranteed
not to exceed this number.</p></td>
    </tr>
    <tr>
      <th>absError</th>
      <td><p>The maximum absolute error tolerated</p></td>
    </tr>
    <tr>
      <th>doChecking</th>
      <td><p>As of version 2.0, this flag is ignored and will
be dropped in forthcoming versions</p></td>
    </tr>
    <tr>
      <th>vectorInterface</th>
      <td><p>A flag that indicates whether to use the
vector interface and is by default FALSE. See details below</p></td>
    </tr>
    <tr>
      <th>norm</th>
      <td><p>For vector-valued integrands, <code>norm</code> specifies the
norm that is used to measure the error and determine
convergence properties. See below.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The returned value is a list of three items:</p>
<dt>integral</dt><dd><p>the value of the integral</p></dd> <dt>error</dt><dd><p>the
estimated relative error</p></dd> <dt>functionEvaluations</dt><dd><p>the number
of times the function was evaluated</p></dd> <dt>returnCode</dt><dd><p>the
actual integer return code of the C routine</p></dd>

    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The function merely calls Johnson's C code and returns the results.</p>
<p>One can specify a maximum number of function evaluations (default is 0 for
no limit).  Otherwise, the integration stops when the estimated error is
less than the absolute error requested, or when the estimated error is less
than tol times the integral, in absolute value, or the maximum number of
iterations is reached (see parameter info below), whichever is earlier.</p>
<p>For compatibility with earlier versions, the <code>adaptIntegrate</code> function
is an alias for the underlying <code>hcubature</code> function which uses h-adaptive
integration. Otherwise, the calling conventions are the same.</p>
<p>We highly recommend referring to the vignette to achieve the best results!</p>
<p>The <code>hcubature</code> function is the h-adaptive version that recursively partitions
the integration domain into smaller subdomains, applying the same integration
rule to each, until convergence is achieved.</p>
<p>The p-adaptive version, <code>pcubature</code>, repeatedly doubles the degree
of the quadrature rules until convergence is achieved, and is based on a tensor
product of Clenshaw-Curtis quadrature rules. This algorithm is often superior
to h-adaptive integration for smooth integrands in a few (&lt;=3) dimensions,
but is a poor choice in higher dimensions or for non-smooth integrands.
Compare with <code>hcubature</code> which also takes the same arguments.</p>
<p>The vector interface requires the integrand to take a matrix as its argument.
The return value should also be a matrix. The number of points at which the
integrand may be evaluated is not under user control: the integration routine
takes care of that and this number may run to several hundreds. We strongly
advise vectorization; see vignette.</p>
<p>The <code>norm</code> argument is irrelevant for scalar integrands and is ignored.
Given vectors \(v\) and \(e\) of estimated integrals and errors therein,
respectively, the <code>norm</code> argument takes on one of the following values:</p><dl class='dl-horizontal'>
<dt><code>INDIVIDUAL</code></dt><dd><p>Convergence is achieved only when each integrand
(each component of \(v\) and \(e\)) individually satisfies the requested
error tolerances</p></dd>
<dt><code>L1</code>, <code>L2</code>, <code>LINF</code></dt><dd><p>The absolute error is measured as
\(|e|\) and the relative error as \(|e|/|v|\), where \(|...|\) is the
\(L_1\), \(L_2\), or \(\L_{\infty}\) norm, respectively</p></dd>
<dt><code>PAIRED</code></dt><dd><p>Like <code>INDIVIDUAL</code>, except that the integrands are
grouped into consecutive pairs, with the error tolerance applied in an
\(L_2\) sense to each pair. This option is mainly useful for integrating
vectors of complex numbers, where each consecutive pair of real integrands
is the real and imaginary parts of a single complex integrand, and the concern
is only the error in the complex plane rather than the error in the real and
imaginary parts separately</p></dd>
</dl>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
</div><span class='co'># NOT RUN {</span>
<span class='co'>## Test function 0</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 2 1e-4 0 0</span>
<span class='co'>## 2-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 0: integral = 0.708073, est err = 1.70943e-05, true err = 7.69005e-09</span>
<span class='co'>## #evals = 17</span>

<span class='no'>testFn0</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='fu'>prod</span>(<span class='fu'>cos</span>(<span class='no'>x</span>))
}

<span class='fu'>hcubature</span>(<span class='no'>testFn0</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='fu'>pcubature</span>(<span class='no'>testFn0</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='no'>M_2_SQRTPI</span> <span class='kw'>&lt;-</span> <span class='fl'>2</span>/<span class='fu'>sqrt</span>(<span class='no'>pi</span>)

<span class='co'>## Test function 1</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 3 1e-4 1 0</span>
<span class='co'>## 3-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 1: integral = 1.00001, est err = 9.67798e-05, true err = 9.76919e-06</span>
<span class='co'>## #evals = 5115</span>

<span class='no'>testFn1</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='no'>val</span> <span class='kw'>&lt;-</span> <span class='fu'>sum</span> (((<span class='fl'>1</span>-<span class='no'>x</span>) / <span class='no'>x</span>)^<span class='fl'>2</span>)
  <span class='no'>scale</span> <span class='kw'>&lt;-</span> <span class='fu'>prod</span>(<span class='no'>M_2_SQRTPI</span>/<span class='no'>x</span>^<span class='fl'>2</span>)
  <span class='fu'>exp</span>(-<span class='no'>val</span>) * <span class='no'>scale</span>
}

<span class='fu'>hcubature</span>(<span class='no'>testFn1</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>, <span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFn1</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>, <span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='co'>##</span>
<span class='co'>## Test function 2</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 2 1e-4 2 0</span>
<span class='co'>## 2-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 2: integral = 0.19728, est err = 1.97261e-05, true err = 4.58316e-05</span>
<span class='co'>## #evals = 166141</span>

<span class='no'>testFn2</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='co'>## discontinuous objective: volume of hypersphere</span>
  <span class='no'>radius</span> <span class='kw'>&lt;-</span> <span class='fu'>as.double</span>(<span class='fl'>0.50124145262344534123412</span>)
  <span class='fu'>ifelse</span>(<span class='fu'>sum</span>(<span class='no'>x</span>*<span class='no'>x</span>) <span class='kw'>&lt;</span> <span class='no'>radius</span>*<span class='no'>radius</span>, <span class='fl'>1</span>, <span class='fl'>0</span>)
}

<span class='fu'>hcubature</span>(<span class='no'>testFn2</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>, <span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFn2</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>, <span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='co'>##</span>
<span class='co'>## Test function 3</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 3 1e-4 3 0</span>
<span class='co'>## 3-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 3: integral = 1, est err = 0, true err = 2.22045e-16</span>
<span class='co'>## #evals = 33</span>

<span class='no'>testFn3</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='fu'>prod</span>(<span class='fl'>2</span>*<span class='no'>x</span>)
}

<span class='fu'>hcubature</span>(<span class='no'>testFn3</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFn3</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='co'>##</span>
<span class='co'>## Test function 4 (Gaussian centered at 1/2)</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 2 1e-4 4 0</span>
<span class='co'>## 2-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 4: integral = 1, est err = 9.84399e-05, true err = 2.78894e-06</span>
<span class='co'>## #evals = 1853</span>

<span class='no'>testFn4</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fl'>0.1</span>
  <span class='no'>s</span> <span class='kw'>&lt;-</span> <span class='fu'>sum</span>((<span class='no'>x</span> - <span class='fl'>0.5</span>)^<span class='fl'>2</span>)
  (<span class='no'>M_2_SQRTPI</span> / (<span class='fl'>2.</span> * <span class='no'>a</span>))^<span class='fu'>length</span>(<span class='no'>x</span>) * <span class='fu'>exp</span> (-<span class='no'>s</span> / (<span class='no'>a</span> * <span class='no'>a</span>))
}

<span class='fu'>hcubature</span>(<span class='no'>testFn4</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFn4</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>2</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='co'>##</span>
<span class='co'>## Test function 5 (double Gaussian)</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 3 1e-4 5 0</span>
<span class='co'>## 3-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 5: integral = 0.999994, est err = 9.98015e-05, true err = 6.33407e-06</span>
<span class='co'>## #evals = 59631</span>

<span class='no'>testFn5</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='no'>a</span> <span class='kw'>&lt;-</span> <span class='fl'>0.1</span>
  <span class='no'>s1</span> <span class='kw'>&lt;-</span> <span class='fu'>sum</span>((<span class='no'>x</span> - <span class='fl'>1</span>/<span class='fl'>3</span>)^<span class='fl'>2</span>)
  <span class='no'>s2</span> <span class='kw'>&lt;-</span> <span class='fu'>sum</span>((<span class='no'>x</span> - <span class='fl'>2</span>/<span class='fl'>3</span>)^<span class='fl'>2</span>)
  <span class='fl'>0.5</span> * (<span class='no'>M_2_SQRTPI</span> / (<span class='fl'>2.</span> * <span class='no'>a</span>))^<span class='fu'>length</span>(<span class='no'>x</span>) * (<span class='fu'>exp</span>(-<span class='no'>s1</span> / (<span class='no'>a</span> * <span class='no'>a</span>)) + <span class='fu'>exp</span>(-<span class='no'>s2</span> / (<span class='no'>a</span> * <span class='no'>a</span>)))
}

<span class='fu'>hcubature</span>(<span class='no'>testFn5</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFn5</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='co'>##</span>
<span class='co'>## Test function 6 (Tsuda's example)</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 4 1e-4 6 0</span>
<span class='co'>## 4-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 6: integral = 0.999998, est err = 9.99685e-05, true err = 1.5717e-06</span>
<span class='co'>## #evals = 18753</span>

<span class='no'>testFn6</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='no'>a</span> <span class='kw'>&lt;-</span> (<span class='fl'>1</span> + <span class='fu'>sqrt</span>(<span class='fl'>10.0</span>)) / <span class='fl'>9.0</span>
  <span class='fu'>prod</span>(<span class='no'>a</span> / (<span class='no'>a</span> + <span class='fl'>1</span>) * ((<span class='no'>a</span> + <span class='fl'>1</span>) / (<span class='no'>a</span> + <span class='no'>x</span>))^<span class='fl'>2</span>)
}

<span class='fu'>hcubature</span>(<span class='no'>testFn6</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>4</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>4</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFn6</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>4</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>4</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)


<span class='co'>##</span>
<span class='co'>## Test function 7</span>
<span class='co'>##   test integrand from W. J. Morokoff and R. E. Caflisch, "Quasi=</span>
<span class='co'>##   Monte Carlo integration," J. Comput. Phys 122, 218-230 (1995).</span>
<span class='co'>##   Designed for integration on [0,1]^dim, integral = 1. */</span>
<span class='co'>## Compare with original cubature result of</span>
<span class='co'>## ./cubature_test 3 1e-4 7 0</span>
<span class='co'>## 3-dim integral, tolerance = 0.0001</span>
<span class='co'>## integrand 7: integral = 1.00001, est err = 9.96657e-05, true err = 1.15994e-05</span>
<span class='co'>## #evals = 7887</span>

<span class='no'>testFn7</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='no'>n</span> <span class='kw'>&lt;-</span> <span class='fu'>length</span>(<span class='no'>x</span>)
  <span class='no'>p</span> <span class='kw'>&lt;-</span> <span class='fl'>1</span>/<span class='no'>n</span>
  (<span class='fl'>1</span> + <span class='no'>p</span>)^<span class='no'>n</span> * <span class='fu'>prod</span>(<span class='no'>x</span>^<span class='no'>p</span>)
}

<span class='fu'>hcubature</span>(<span class='no'>testFn7</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFn7</span>, <span class='fu'>rep</span>(<span class='fl'>0</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)


<span class='co'>## Example from web page</span>
<span class='co'>## http://ab-initio.mit.edu/wiki/index.php/Cubature</span>
<span class='co'>##</span>
<span class='co'>## f(x) = exp(-0.5(euclidean_norm(x)^2)) over the three-dimensional</span>
<span class='co'>## hyperbcube [-2, 2]^3</span>
<span class='co'>## Compare with original cubature result</span>
<span class='no'>testFnWeb</span> <span class='kw'>&lt;-</span>  <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='fu'>exp</span>(-<span class='fl'>0.5</span> * <span class='fu'>sum</span>(<span class='no'>x</span>^<span class='fl'>2</span>))
}

<span class='fu'>hcubature</span>(<span class='no'>testFnWeb</span>, <span class='fu'>rep</span>(-<span class='fl'>2</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>2</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)
<span class='fu'>pcubature</span>(<span class='no'>testFnWeb</span>, <span class='fu'>rep</span>(-<span class='fl'>2</span>,<span class='fl'>3</span>), <span class='fu'>rep</span>(<span class='fl'>2</span>,<span class='fl'>3</span>), <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-4</span>)

<span class='co'>## Test function I.1d from</span>
<span class='co'>## Numerical integration using Wang-Landau sampling</span>
<span class='co'>## Y. W. Li, T. Wust, D. P. Landau, H. Q. Lin</span>
<span class='co'>## Computer Physics Communications, 2007, 524-529</span>
<span class='co'>## Compare with exact answer: 1.63564436296</span>
<span class='co'>##</span>
<span class='no'>I.1d</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='fu'>sin</span>(<span class='fl'>4</span>*<span class='no'>x</span>) *
    <span class='no'>x</span> * ((<span class='no'>x</span> * ( <span class='no'>x</span> * (<span class='no'>x</span>*<span class='no'>x</span>-<span class='fl'>4</span>) + <span class='fl'>1</span>) - <span class='fl'>1</span>))
}

<span class='fu'>hcubature</span>(<span class='no'>I.1d</span>, -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-7</span>)
<span class='fu'>pcubature</span>(<span class='no'>I.1d</span>, -<span class='fl'>2</span>, <span class='fl'>2</span>, <span class='kw'>tol</span><span class='kw'>=</span><span class='fl'>1e-7</span>)

<span class='co'>## Test function I.2d from</span>
<span class='co'>## Numerical integration using Wang-Landau sampling</span>
<span class='co'>## Y. W. Li, T. Wust, D. P. Landau, H. Q. Lin</span>
<span class='co'>## Computer Physics Communications, 2007, 524-529</span>
<span class='co'>## Compare with exact answer: -0.01797992646</span>
<span class='co'>##</span>
<span class='co'>##</span>
<span class='no'>I.2d</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span>(<span class='no'>x</span>) {
  <span class='no'>x1</span> <span class='kw'>=</span> <span class='no'>x</span>[<span class='fl'>1</span>]
  <span class='no'>x2</span> <span class='kw'>=</span> <span class='no'>x</span>[<span class='fl'>2</span>]
  <span class='fu'>sin</span>(<span class='fl'>4</span>*<span class='no'>x1</span>+<span class='fl'>1</span>) * <span class='fu'>cos</span>(<span class='fl'>4</span>*<span class='no'>x2</span>) * <span class='no'>x1</span> * (<span class='no'>x1</span>*(<span class='no'>x1</span>*<span class='no'>x1</span>)^<span class='fl'>2</span> - <span class='no'>x2</span>*(<span class='no'>x2</span>*<span class='no'>x2</span> - <span class='no'>x1</span>) +<span class='fl'>2</span>)
}

<span class='fu'>hcubature</span>(<span class='no'>I.2d</span>, <span class='fu'>rep</span>(-<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='kw'>maxEval</span><span class='kw'>=</span><span class='fl'>10000</span>)
<span class='fu'>pcubature</span>(<span class='no'>I.2d</span>, <span class='fu'>rep</span>(-<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='fu'>rep</span>(<span class='fl'>1</span>, <span class='fl'>2</span>), <span class='kw'>maxEval</span><span class='kw'>=</span><span class='fl'>10000</span>)

<span class='co'>##</span>
<span class='co'>## Example of multivariate normal integration borrowed from</span>
<span class='co'>## package mvtnorm (on CRAN) to check ... argument</span>
<span class='co'>## Compare with output of</span>
<span class='co'>## pmvnorm(lower=rep(-0.5, m), upper=c(1,4,2), mean=rep(0, m), corr=sigma, alg=Miwa())</span>
<span class='co'>##     0.3341125.  Blazing quick as well!  Ours is, not unexpectedly, much slower.</span>
<span class='co'>##</span>
<span class='no'>dmvnorm</span> <span class='kw'>&lt;-</span> <span class='kw'>function</span> (<span class='no'>x</span>, <span class='no'>mean</span>, <span class='no'>sigma</span>, <span class='no'>log</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>) {
    <span class='kw'>if</span> (<span class='fu'>is.vector</span>(<span class='no'>x</span>)) {
        <span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>matrix</span>(<span class='no'>x</span>, <span class='kw'>ncol</span> <span class='kw'>=</span> <span class='fu'>length</span>(<span class='no'>x</span>))
    }
    <span class='kw'>if</span> (<span class='fu'>missing</span>(<span class='no'>mean</span>)) {
        <span class='no'>mean</span> <span class='kw'>&lt;-</span> <span class='fu'>rep</span>(<span class='fl'>0</span>, <span class='kw'>length</span> <span class='kw'>=</span> <span class='fu'>ncol</span>(<span class='no'>x</span>))
    }
    <span class='kw'>if</span> (<span class='fu'>missing</span>(<span class='no'>sigma</span>)) {
        <span class='no'>sigma</span> <span class='kw'>&lt;-</span> <span class='fu'>diag</span>(<span class='fu'>ncol</span>(<span class='no'>x</span>))
    }
    <span class='kw'>if</span> (<span class='fu'>NCOL</span>(<span class='no'>x</span>) <span class='kw'>!=</span> <span class='fu'>NCOL</span>(<span class='no'>sigma</span>)) {
        <span class='fu'>stop</span>(<span class='st'>"x and sigma have non-conforming size"</span>)
    }
    <span class='kw'>if</span> (!<span class='fu'>isSymmetric</span>(<span class='no'>sigma</span>, <span class='kw'>tol</span> <span class='kw'>=</span> <span class='fu'>sqrt</span>(<span class='no'>.Machine</span>$<span class='no'>double.eps</span>),
        <span class='kw'>check.attributes</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)) {
        <span class='fu'>stop</span>(<span class='st'>"sigma must be a symmetric matrix"</span>)
    }
    <span class='kw'>if</span> (<span class='fu'>length</span>(<span class='no'>mean</span>) <span class='kw'>!=</span> <span class='fu'>NROW</span>(<span class='no'>sigma</span>)) {
        <span class='fu'>stop</span>(<span class='st'>"mean and sigma have non-conforming size"</span>)
    }
    <span class='no'>distval</span> <span class='kw'>&lt;-</span> <span class='fu'>mahalanobis</span>(<span class='no'>x</span>, <span class='kw'>center</span> <span class='kw'>=</span> <span class='no'>mean</span>, <span class='kw'>cov</span> <span class='kw'>=</span> <span class='no'>sigma</span>)
    <span class='no'>logdet</span> <span class='kw'>&lt;-</span> <span class='fu'>sum</span>(<span class='fu'>log</span>(<span class='fu'>eigen</span>(<span class='no'>sigma</span>, <span class='kw'>symmetric</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>only.values</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)$<span class='no'>values</span>))
    <span class='no'>logretval</span> <span class='kw'>&lt;-</span> -(<span class='fu'>ncol</span>(<span class='no'>x</span>) * <span class='fu'>log</span>(<span class='fl'>2</span> * <span class='no'>pi</span>) + <span class='no'>logdet</span> + <span class='no'>distval</span>)/<span class='fl'>2</span>
    <span class='kw'>if</span> (<span class='no'>log</span>)
        <span class='fu'>return</span>(<span class='no'>logretval</span>)
    <span class='fu'>exp</span>(<span class='no'>logretval</span>)
}

<span class='no'>m</span> <span class='kw'>&lt;-</span> <span class='fl'>3</span>
<span class='no'>sigma</span> <span class='kw'>&lt;-</span> <span class='fu'>diag</span>(<span class='fl'>3</span>)
<span class='no'>sigma</span>[<span class='fl'>2</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>sigma</span>[<span class='fl'>1</span>, <span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='fl'>3</span>/<span class='fl'>5</span> ; <span class='no'>sigma</span>[<span class='fl'>3</span>,<span class='fl'>1</span>] <span class='kw'>&lt;-</span> <span class='no'>sigma</span>[<span class='fl'>1</span>, <span class='fl'>3</span>] <span class='kw'>&lt;-</span> <span class='fl'>1</span>/<span class='fl'>3</span>
<span class='no'>sigma</span>[<span class='fl'>3</span>,<span class='fl'>2</span>] <span class='kw'>&lt;-</span> <span class='no'>sigma</span>[<span class='fl'>2</span>, <span class='fl'>3</span>] <span class='kw'>&lt;-</span> <span class='fl'>11</span>/<span class='fl'>15</span>
<span class='fu'>hcubature</span>(<span class='no'>dmvnorm</span>, <span class='kw'>lower</span><span class='kw'>=</span><span class='fu'>rep</span>(-<span class='fl'>0.5</span>, <span class='no'>m</span>), <span class='kw'>upper</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>4</span>,<span class='fl'>2</span>),
                        <span class='kw'>mean</span><span class='kw'>=</span><span class='fu'>rep</span>(<span class='fl'>0</span>, <span class='no'>m</span>), <span class='kw'>sigma</span><span class='kw'>=</span><span class='no'>sigma</span>, <span class='kw'>log</span><span class='kw'>=</span><span class='fl'>FALSE</span>,
               <span class='kw'>maxEval</span><span class='kw'>=</span><span class='fl'>10000</span>)
<span class='fu'>pcubature</span>(<span class='no'>dmvnorm</span>, <span class='kw'>lower</span><span class='kw'>=</span><span class='fu'>rep</span>(-<span class='fl'>0.5</span>, <span class='no'>m</span>), <span class='kw'>upper</span><span class='kw'>=</span><span class='fu'>c</span>(<span class='fl'>1</span>,<span class='fl'>4</span>,<span class='fl'>2</span>),
                        <span class='kw'>mean</span><span class='kw'>=</span><span class='fu'>rep</span>(<span class='fl'>0</span>, <span class='no'>m</span>), <span class='kw'>sigma</span><span class='kw'>=</span><span class='no'>sigma</span>, <span class='kw'>log</span><span class='kw'>=</span><span class='fl'>FALSE</span>,
               <span class='kw'>maxEval</span><span class='kw'>=</span><span class='fl'>10000</span>)
<span class='co'># }</span><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Balasubramanian Narasimhan

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='https://statistics.stanford.edu/people/balasubramanian-narasimhan'>Balasubramanian Narasimhan</a>, <a href='https://math.mit.edu/~stevenj/'>Steven G. Johnson</a>, <a href='https://wwwth.mpp.mpg.de/members/hahn/'>Thomas Hahn</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

